<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-blog">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Tran Lam" href="/blogs/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/blogs/blog/rss.xml" title="Tran Lam RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blogs/blog/atom.xml" title="Tran Lam Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Tạo 1 Standalone Spark Cluster với Docker</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lam1051999.github.io//blogs/blog/spark-cluster-docker"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Tạo 1 Standalone Spark Cluster với Docker | Tran Lam"><meta data-rh="true" name="description" content="Cluster Overview"><meta data-rh="true" property="og:description" content="Cluster Overview"><meta data-rh="true" property="og:image" content="https://lam1051999.github.io//blogs/assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG"><meta data-rh="true" name="twitter:image" content="https://lam1051999.github.io//blogs/assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-01-01T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/lam1051999"><meta data-rh="true" property="article:tag" content="Bigdata,Spark,Apache,Docker"><link data-rh="true" rel="icon" href="/blogs/img/de.svg"><link data-rh="true" rel="canonical" href="https://lam1051999.github.io//blogs/blog/spark-cluster-docker"><link data-rh="true" rel="alternate" href="https://lam1051999.github.io//blogs/blog/spark-cluster-docker" hreflang="en"><link data-rh="true" rel="alternate" href="https://lam1051999.github.io//blogs/blog/spark-cluster-docker" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KPAEHOL9XK-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/blogs/assets/css/styles.7b917ad4.css">
<link rel="preload" href="/blogs/assets/js/runtime~main.50c9fcba.js" as="script">
<link rel="preload" href="/blogs/assets/js/main.784bdc81.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/blogs/"><div class="navbar__logo"><img src="/blogs/img/de.svg" alt="TL Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/blogs/img/de.svg" alt="TL Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Tran Lam</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blogs/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blogs/blog">Blog</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/spark-catalyst-optimizer-and-spark-extension">Spark catalyst optimizer và Spark extension</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/mysql-series-mysql-indexing">MySQL series - Indexing</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/mysql-series-mysql-mvcc">MySQL series - Multiversion concurrency control</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/mysql-series-mysql-transaction">MySQL series - Transaction trong MySQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/mysql-series-mysql-architecture">MySQL series - Tổng quan kiến trúc MySQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/spark-kafka-docker">Tạo luồng streaming dữ liệu với Spark Streaming, Kafka, Docker</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blogs/blog/spark-cluster-docker">Tạo 1 Standalone Spark Cluster với Docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/ai-interview-questions">Một số câu hỏi phỏng vấn AI/ML</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/receptive-field">Receptive field trong thị giác máy tính</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/linear-algebra-part-1">Đại số tuyến tính cơ bản - Phần 1</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/probability">Xác suất thống kê cơ bản</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/avl-tree">Cây AVL, thuật toán sắp xếp AVL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/binarysearch-tree">Cây tìm kiếm nhị phân</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/sorting-algorithms">Các thuật toán sắp xếp cơ bản</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blogs/blog/peak-finding">Thuật toán tìm đỉnh Peak Finding</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_Ikge" itemprop="headline">Tạo 1 Standalone Spark Cluster với Docker</h1><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2022-01-01T00:00:00.000Z" itemprop="datePublished">January 1, 2022</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/lam1051999" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/lam1051999.png" alt="Trần Lâm"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/lam1051999" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Trần Lâm</span></a></div><small class="avatar__subtitle" itemprop="description">Data Engineer</small></div></div></div></div></header><meta itemprop="image" content="https://lam1051999.github.io//blogs/assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG"><div id="post-content" class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="Cluster Overview" src="/blogs/assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG" width="596" height="286" class="img_ev3q"></p><p>Thời gian vừa qua, mình đã dành nhiều thời gian tự học về cách xây dựng các cluster Hadoop, Spark, tích hợp Hive và một số thứ nữa. Bài viết này sẽ viết về cách bạn có thể xây dựng một Spark cluster cho việc xử lý dữ liệu bằng Docker, bao gồm 1 master node và 2 worker node, loại cluster là standalone cluster (có thể các bài viết sắp tới mình sẽ làm về Hadoop cluster và tích hợp resource manager là Yarn). Cùng đi vào bài viết nào.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-tổng-quan-về-cấu-trúc-và-cách-hoạt-động-của-một-spark-cluster">1. Tổng quan về cấu trúc và cách hoạt động của một Spark cluster<a class="hash-link" href="#1-tổng-quan-về-cấu-trúc-và-cách-hoạt-động-của-một-spark-cluster" title="Direct link to heading">​</a></h3><p>Spark là công cụ xử lý dữ liệu nhanh, mạnh mẽ cho phép bạn xử lý dữ giải quyết vấn đề dữ liệu lớn đối với cả dữ liệu có cấu trúc, bán cấu trúc và không có cấu trúc. Nó cung cấp tính linh hoạt và khả năng mở rộng, được tạo ra để cải thiện hiệu năng của MapReduce nhưng ở một tốc độ cao hơn nhiều: 100 lần nhanh hơn Hadoop khi dữ liệu được lưu trong bộ nhớ và 10 lần khi truy cập ổ đĩa. Nó được thiết kế cho các hiệu suất nhanh và sử dụng RAM để caching và xử lý dữ liệu. Spark không có một file system riêng, nhưng nó có thể tương tác với nhiều loại hệ thống lưu trữ, có thể sử dụng tích hợp với Hadoop. Dưới đây là tổng quan cấu trúc của một ứng dụng Spark.</p><p><img loading="lazy" alt="Cluster Overview" src="/blogs/assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG" width="596" height="286" class="img_ev3q"></p><p>Các ứng dụng Spark sinh ra một chương trình driver ở master node, và tạo ra 1 SparkContext. Để chạy trên 1 cluster, SparkContext cần kết nối đến một trong nhiều loại cluster managers (standalone cluster, Mesos hoặc YARN). Một khi được kết nối, Spark có được kết nối tới các worker nodes ở cluster. Những node đó thực hiện tiến trình làm các công việc tính toán và lưu trữ dữ liệu cho ứng dụng. Sau đó, nó gửi các code đến các executor. Cuối cùng, SparkContext sẽ gửi các tasks cho các executors để chạy.</p><p>Mỗi ứng dụng đều có các tiến trình executors riêng của nó, nằm ở đó suốt thời gian ứng dụng chạy và chạy các task ở nhiều threads, cô lập ứng dụng này với ứng dụng khác. Điều đó cũng có nghĩa là dữ liệu không thể được chia sẻ qua lại giữa các ứng dụng nếu mà không ghi dữ liệu ra một hệ thống lưu trữ ngoài.</p><p>Vì driver đặt lịch trình cho các task trên cluster, nó cần phải chạy gần với các worker node, sẽ là lý tưởng nếu nó chạy cùng một mạng LAN. Nếu bạn muốn gửi các request đến cluster từ xa, nó sẽ tốt hơn nếu như bạn tạo 1 RPC, chạy driver và submit các hoạt động từ phạm vi gần hơn là chạy driver ở khoảng cách xa các node worker.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-tạo-một-base-image">2. Tạo một base image<a class="hash-link" href="#2-tạo-một-base-image" title="Direct link to heading">​</a></h3><p>Bởi vì các image các node trong 1 cluster cần cài đặt các phần mềm khá giống nhau nên chúng ta sẽ xây dựng một base image cho tổng thể cluster trước, sau đó thì các image sau sẽ import từ image này và thêm vào đó là các dependencies cần thiết khác.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG debian_buster_image_tag=8-jre-slim</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM openjdk:${debian_buster_image_tag}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG shared_workspace=/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN mkdir -p ${shared_workspace} &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    apt-get update -y &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    apt-get install -y python3 &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ln -s /usr/bin/python3 /usr/bin/python &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV SHARED_WORKSPACE=${shared_workspace}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">VOLUME ${shared_workspace}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ở đây, vì Spark yêu cầu java phiên bản 8 hoặc 11, nên chúng ta sẽ tạo một image chạy jdk 8, chúng ta sẽ lấy biến <code>shared_workspace</code> là đường dẫn môi trường làm việc của Jupyterlab (ở phần sau). Thêm vào đó, chúng ta sẽ cài <code>python3</code> cho việc chạy Jupyterlab.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-tạo-một-spark-base-image">3. Tạo một spark base image<a class="hash-link" href="#3-tạo-một-spark-base-image" title="Direct link to heading">​</a></h3><p>Ta đến với tạo một spark base image với các package chung cho master node và workder node.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM spark-cluster-base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG spark_version=3.2.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG hadoop_version=3.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN apt-get update -y &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    apt-get install -y curl &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    curl https://archive.apache.org/dist/spark/spark-${spark_version}/spark-${spark_version}-bin-hadoop${hadoop_version}.tgz -o spark.tgz &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tar -xf spark.tgz &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mv spark-${spark_version}-bin-hadoop${hadoop_version} /usr/bin/ &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mkdir /usr/bin/spark-${spark_version}-bin-hadoop${hadoop_version}/logs &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rm spark.tgz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV SPARK_HOME /usr/bin/spark-${spark_version}-bin-hadoop${hadoop_version}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV SPARK_MASTER_HOST spark-master</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV SPARK_MASTER_PORT 7077</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV PYSPARK_PYTHON python3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WORKDIR ${SPARK_HOME}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Đầu tiên, ta sẽ import image từ base image bên trên (là <code>spark-cluster-base</code>, cái tên này sẽ được gán vào thời gian build image), liệt kê các phiên bản Spark và Hadoop tương thích với nhau. Các bạn có thể kiểm tra tương thích phiên bản trên trang chủ của Spark.</p><p><img loading="lazy" alt="Spark Version" src="/blogs/assets/images/spark-version-8e3b1dde17446f2dbe175a8e66750135.PNG" width="2032" height="700" class="img_ev3q"></p><p>Sau đó sẽ là tải và giải nén Spark, cùng với đó là tạo các biến môi trường cần thiết để hỗ trợ chạy command line về sau. Ở đây, <code>SPARK_MASTER_HOST</code> và <code>SPARK_MASTER_PORT</code> được các worker node dùng để register với master node địa chỉ tương ứng.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-tạo-một-master-node-image">4. Tạo một master node image<a class="hash-link" href="#4-tạo-một-master-node-image" title="Direct link to heading">​</a></h3><p>Có một spark base image, ta bắt đầu tạo master node bằng việc import base image đó và thêm các biến phù hợp với master node như là port của giao diện web ui để lát nữa có thể tương tác với spark trên giao diện.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM spark-base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG spark_master_web_ui=8080</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXPOSE ${spark_master_web_ui} ${SPARK_MASTER_PORT}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CMD bin/spark-class org.apache.spark.deploy.master.Master &gt;&gt; logs/spark-master.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Command trên là để chạy master node.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-tạo-một-worker-node-image">5. Tạo một worker node image<a class="hash-link" href="#5-tạo-một-worker-node-image" title="Direct link to heading">​</a></h3><p>Tiếp đến là tạo worker node</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM spark-base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG spark_worker_web_ui=8081</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXPOSE ${spark_worker_web_ui}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CMD bin/spark-class org.apache.spark.deploy.worker.Worker spark://${SPARK_MASTER_HOST}:${SPARK_MASTER_PORT} &gt;&gt; logs/spark-worker.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Command trên là để chạy worker node và trỏ tới địa chỉ của master node để register.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-tạo-một-jupyterlab-image-cho-việc-kiểm-thử">6. Tạo một Jupyterlab image cho việc kiểm thử<a class="hash-link" href="#6-tạo-một-jupyterlab-image-cho-việc-kiểm-thử" title="Direct link to heading">​</a></h3><p>Cuối cùng, để kiểm tra hoạt động của spark cluster, ta sẽ cái Jupyterlab và dùng pyspark để chạy code.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM spark-cluster-base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG spark_version=3.2.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG jupyterlab_version=3.2.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN apt-get update -y &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    apt-get install -y python3-pip &amp;&amp; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pip3 install wget pyspark==${spark_version} jupyterlab==${jupyterlab_version}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXPOSE 8888</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WORKDIR ${SHARED_WORKSPACE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CMD jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root --NotebookApp.token=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Cùng với đó là liệt kê command chạy Jupyter ở port 8888.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-kết-hợp-các-image-và-tạo-các-container">7. Kết hợp các image và tạo các container<a class="hash-link" href="#7-kết-hợp-các-image-và-tạo-các-container" title="Direct link to heading">​</a></h3><p>Sau khi tạo đầy đủ các Dockerfile, ta tiến hành build các image phù hợp.</p><p><img loading="lazy" alt="Folder Structure" src="/blogs/assets/images/folder-structure-96413f7b1388654821531bfb39bbd777.PNG" width="1300" height="890" class="img_ev3q"></p><p><strong>Liệt kê các phiên bản</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SPARK_VERSION=&quot;3.2.0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HADOOP_VERSION=&quot;3.2&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JUPYTERLAB_VERSION=&quot;3.2.5&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build base image</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker build \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --platform=linux/arm64 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f cluster_base/Dockerfile \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-cluster-base .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build spark base image</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker build \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --build-arg spark_version=&quot;${SPARK_VERSION}&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --build-arg hadoop_version=&quot;${HADOOP_VERSION}&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f spark_base/Dockerfile \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-base .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build master node image</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker build \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f master_node/Dockerfile \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-master .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build worker node image</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker build \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f worker_node/Dockerfile \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-worker .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build Jupyterlab image</strong></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker build \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --build-arg spark_version=&quot;${SPARK_VERSION}&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --build-arg jupyterlab_version=&quot;${JUPYTERLAB_VERSION}&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f jupyter_lab/Dockerfile \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-jupyterlab .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Cuối cùng, để tạo các container cần thiết, ta tạo một file <code>docker-compose.yml</code> với nội dung như sau</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">version: &quot;3.6&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  shared-workspace:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name: &quot;hadoop-distributed-file-system&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    driver: local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  jupyterlab:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: spark-jupyterlab</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    container_name: jupyterlab</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - 8888:8888</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - shared-workspace:/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  spark-master:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: spark-master</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    container_name: spark-master</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - 8080:8080</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - 7077:7077</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - shared-workspace:/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  spark-worker-1:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: spark-worker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    container_name: spark-worker-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - SPARK_WORKER_CORES=1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - SPARK_WORKER_MEMORY=512m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - 8081:8081</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - shared-workspace:/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    depends_on:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - spark-master</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  spark-worker-2:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: spark-worker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    container_name: spark-worker-2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - SPARK_WORKER_CORES=1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - SPARK_WORKER_MEMORY=512m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - 8082:8081</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - shared-workspace:/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    depends_on:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - spark-master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Bao gồm volume mà ta sẽ lưu dữ liệu để khi xoá các container không bị mất dữ liệu, cùng với đó là các container (service) cần thiết. Ở mỗi container các biến môi trường phù hợp được thêm vào, các port để map ra máy host, và thứ tự chạy các container. Ở đây, master node phải chạy lên trước để lấy hostname nên worker node sẽ depend vào master node container. Sau đó, ta chạy <code>docker-compose up</code>, như thế là đã khởi chạy hết các container cần thiết rồi.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-chạy-jupyterlab-để-kiểm-tra-hoạt-động-của-cluster">8. Chạy Jupyterlab để kiểm tra hoạt động của cluster<a class="hash-link" href="#8-chạy-jupyterlab-để-kiểm-tra-hoạt-động-của-cluster" title="Direct link to heading">​</a></h3><p>Sau khi đã chạy <code>docker-compose up</code> và thấy ở terminal các logs thể hiện đã khởi động thành công master node và worker node, cùng với trạng thái register thành công của các node, ta vào <code>localhost:8080</code> để xem spark ui.</p><p><img loading="lazy" alt="Spark UI" src="/blogs/assets/images/spark-ui-78bc7baa81ca206a2e4c6e7059aeeffb.PNG" width="2880" height="1324" class="img_ev3q"></p><p>Ở giao diện, ta thấy được có 2 worker đang hoạt động như vùng khoanh đỏ.</p><p>Vào <code>localhost:8888</code> để vào giao diện Jupyterlab, thực hiện code sau</p><p><img loading="lazy" alt="Jupyter Lab" src="/blogs/assets/images/jupyterlab-cd81775f3664471769264e9d69acd378.PNG" width="2880" height="1634" class="img_ev3q"></p><p>Chạy code, rồi quay lại spark ui, ta thấy được ứng dụng của ta đang chạy</p><p><img loading="lazy" alt="Application" src="/blogs/assets/images/application-69b2a227be1eef29691bb5aefd65c6e9.PNG" width="2880" height="1236" class="img_ev3q"></p><p>Ấn vào ứng dụng, ta thấy các worker của ta đang xử lý job</p><p><img loading="lazy" alt="Application Workers" src="/blogs/assets/images/application-workers-542d26c362e926281666cbf113750eb5.PNG" width="2878" height="952" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_u0Nl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blogs/blog/tags/bigdata">Bigdata</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blogs/blog/tags/spark">Spark</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blogs/blog/tags/apache">Apache</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blogs/blog/tags/docker">Docker</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/lam1051999/blogs/edit/main/blog/2022-01-01-spark-cluster-docker/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><div class="margin-vert--xl"></div><div class="margin-vert--lg" style="display:flex;align-items:center;justify-content:center"><a class="button button--link" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flam1051999.github.io%2F%2Fblogs%2Fblog%2Fspark-cluster-docker&amp;text=I%20just%20read%20%22T%E1%BA%A1o%201%20Standalone%20Spark%20Cluster%20v%E1%BB%9Bi%20Docker%22%20by%20%40kgajera24" target="_blank" rel="noreferrer noopener" style="display:inline-flex;align-items:center"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 248 204" height="20" width="20" style="margin-right:7px"><g><path fill="#1D9BF0" d="M221.95,51.29c0.15,2.17,0.15,4.34,0.15,6.53c0,66.73-50.8,143.69-143.69,143.69v-0.04 C50.97,201.51,24.1,193.65,1,178.83c3.99,0.48,8,0.72,12.02,0.73c22.74,0.02,44.83-7.61,62.72-21.66 c-21.61-0.41-40.56-14.5-47.18-35.07c7.57,1.46,15.37,1.16,22.8-0.87C27.8,117.2,10.85,96.5,10.85,72.46c0-0.22,0-0.43,0-0.64 c7.02,3.91,14.88,6.08,22.92,6.32C11.58,63.31,4.74,33.79,18.14,10.71c25.64,31.55,63.47,50.73,104.08,52.76 c-4.07-17.54,1.49-35.92,14.61-48.25c20.34-19.12,52.33-18.14,71.45,2.19c11.31-2.23,22.15-6.38,32.07-12.26 c-3.77,11.69-11.66,21.62-22.2,27.93c10.01-1.18,19.79-3.86,29-7.95C240.37,35.29,231.83,44.14,221.95,51.29z"></path></g></svg>Share on Twitter</a></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blogs/blog/spark-kafka-docker"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Tạo luồng streaming dữ liệu với Spark Streaming, Kafka, Docker</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blogs/blog/ai-interview-questions"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Một số câu hỏi phỏng vấn AI/ML</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-tổng-quan-về-cấu-trúc-và-cách-hoạt-động-của-một-spark-cluster" class="table-of-contents__link toc-highlight">1. Tổng quan về cấu trúc và cách hoạt động của một Spark cluster</a></li><li><a href="#2-tạo-một-base-image" class="table-of-contents__link toc-highlight">2. Tạo một base image</a></li><li><a href="#3-tạo-một-spark-base-image" class="table-of-contents__link toc-highlight">3. Tạo một spark base image</a></li><li><a href="#4-tạo-một-master-node-image" class="table-of-contents__link toc-highlight">4. Tạo một master node image</a></li><li><a href="#5-tạo-một-worker-node-image" class="table-of-contents__link toc-highlight">5. Tạo một worker node image</a></li><li><a href="#6-tạo-một-jupyterlab-image-cho-việc-kiểm-thử" class="table-of-contents__link toc-highlight">6. Tạo một Jupyterlab image cho việc kiểm thử</a></li><li><a href="#7-kết-hợp-các-image-và-tạo-các-container" class="table-of-contents__link toc-highlight">7. Kết hợp các image và tạo các container</a></li><li><a href="#8-chạy-jupyterlab-để-kiểm-tra-hoạt-động-của-cluster" class="table-of-contents__link toc-highlight">8. Chạy Jupyterlab để kiểm tra hoạt động của cluster</a></li></ul></div></div></div></div></div><div class="footer-wrapper footer--dark"><div class="container margin-vert--lg"><div style="display:flex;justify-content:center"><div style="max-width:650px">I believe each of us was designed to do certain things, that we have certain duties. Most significantly, since nature intended us to be social creatures, we have duties to our fellow men.</div><div style="margin-left:30px;min-width:169px"><img src="/blogs/img/avatar.jpg" style="height:154px;width:139px"><p style="font-size:0.8em;margin-top:1em">Tran Lam<br>Data Engineer</p></div></div></div><div style="display:flex;justify-content:center"><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blogs/">About</a></li><li class="footer__item"><a class="footer__link-item" href="/blogs/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:lam1051999@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mail<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/lamtt1005" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="tel:+84962007024" target="_blank" rel="noopener noreferrer" class="footer__link-item">Phone<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/lam1051999" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Tran Lam. All content is the property of Tran Lam.</div></div></div></footer></div></div></div>
<script src="/blogs/assets/js/runtime~main.50c9fcba.js"></script>
<script src="/blogs/assets/js/main.784bdc81.js"></script>
</body>
</html>