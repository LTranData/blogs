<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-blog">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PK0DHL0FKW"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-PK0DHL0FKW",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Lam Tran" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Lam Tran RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Lam Tran Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7172314318777821" async crossorigin="anonymous"></script><title data-rh="true">Create A Standalone Spark Cluster With Docker</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lam-tran.dev//blog/spark-cluster-docker"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="Data Engineering, Web Development, Blog"><meta data-rh="true" name="title" content="Lam Tran"><meta data-rh="true" property="og:title" content="Create A Standalone Spark Cluster With Docker | Lam Tran"><meta data-rh="true" name="description" content="Create A Standalone Spark Cluster With Docker"><meta data-rh="true" property="og:description" content="Create A Standalone Spark Cluster With Docker"><meta data-rh="true" property="og:image" content="https://lam-tran.dev//assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG"><meta data-rh="true" name="twitter:image" content="https://lam-tran.dev//assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-01-01T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/lam1051999"><meta data-rh="true" property="article:tag" content="Bigdata,Spark,Apache,Docker"><link data-rh="true" rel="icon" href="/img/lt_logo.svg"><link data-rh="true" rel="canonical" href="https://lam-tran.dev//blog/spark-cluster-docker"><link data-rh="true" rel="alternate" href="https://lam-tran.dev//blog/spark-cluster-docker" hreflang="en"><link data-rh="true" rel="alternate" href="https://lam-tran.dev//blog/spark-cluster-docker" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GIW3CHZWR8-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.2e718d97.css">
<link rel="preload" href="/assets/js/runtime~main.2ccc56fd.js" as="script">
<link rel="preload" href="/assets/js/main.22b74e23.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/lt_logo.svg" alt="TL Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/lt_logo.svg" alt="TL Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Lam Tran</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/how-is-memory-managed-in-spark">How Is Memory Managed In Spark?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/state-management-react">State Management In React</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mini-spark3-authorizer-part-2">Authorize Spark 3 SQL With Apache Ranger Part 2 - Integrate Spark SQL With Ranger</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mini-spark3-authorizer-part-1">Authorize Spark 3 SQL With Apache Ranger Part 1 - Ranger installation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/spark-catalyst-optimizer-and-spark-session-extension">Spark Catalyst Optimizer And Spark Session Extension</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mysql-series-mysql-indexing">MySQL series - Indexing</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mysql-series-mysql-mvcc">MySQL series - Multiversion concurrency control</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mysql-series-mysql-transaction">MySQL series - Transaction In MySQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mysql-series-mysql-architecture">MySQL series - MySQL Architecture Overview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/spark-kafka-docker">Create A Data Streaming Pipeline With Spark Streaming, Kafka And Docker</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/spark-cluster-docker">Create A Standalone Spark Cluster With Docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/avl-tree">AVL Tree, AVL Sorting Algorithm</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/binarysearch-tree">Binary Search Tree</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/sorting-algorithms">Fundamental Sorting Algorithms</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/peak-finding">Peak Finding Algorithm</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_Ikge" itemprop="headline">Create A Standalone Spark Cluster With Docker</h1><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2022-01-01T00:00:00.000Z" itemprop="datePublished">January 1, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/lam1051999" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/lam1051999.png" alt="Lam Tran"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/lam1051999" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Lam Tran</span></a></div><small class="avatar__subtitle" itemprop="description">Data Engineer</small></div></div></div></div></header><meta itemprop="image" content="https://lam-tran.dev//assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG"><div id="post-content" class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="Cluster Overview" src="/assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG" width="596" height="286" class="img_ev3q"></p><p>Lately, I&#x27;ve spent a lot of time teaching myself how to build Hadoop clusters, Spark, Hive integration, and more. This article will write about how you can build a Spark cluster for data processing using Docker, including 1 master node and 2 worker nodes, the cluster type is standalone cluster (maybe the upcoming articles I will do about Hadoop cluster and integrated resource manager is Yarn). Let&#x27;s go to the article.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-overview-of-a-spark-cluster">1. Overview of a Spark cluster<a class="hash-link" href="#1-overview-of-a-spark-cluster" title="Direct link to heading">​</a></h3><p>Apache Spark is a data processing framework that can quickly perform processing tasks on very large data sets, and can also distribute tasks across multiple computers. It was design for fast computing and use RAM for caching and processing data.</p><p>It provides flexibility and scalability, created to improve the performance of MapReduce but at a much higher speed: 100 times faster than Hadoop when data is stored in memory and 10 times faster when accessed CD driver.</p><p>Spark does not have a file system of its own, but it can interact with many types of storage systems and can be used to integrate with Hadoop. Below is an overview of the structure of a Spark application.</p><p><img loading="lazy" alt="Cluster Overview" src="/assets/images/cluster-overview-e73d0350f6f913d028c171532a18cc2a.PNG" width="596" height="286" class="img_ev3q"></p><p>Each time we submit a Spark application, it will create a driver program at the master node, which then create a SparkContext object. To be able to run in a cluster, SparkContext need to connect to a cluster resource manager, that could be Spark’s standalone cluster manager, Mesos or Yarn. Once the SparkContext get the connection, it will have specific RAM and CPU resources of the worker nodes in the cluster.</p><p>Each worker node will receive the code and tasks from the driver, compute and process the data.</p><p>The master node will be responsible for scheduling all the tasks and send those to the worker nodes so it’s ideal when we put it in the same network area with all the worker nodes to achieve low latency between requests</p><p>There are 2 Spark running modes</p><ul><li><strong>Running locally:</strong> running all the tasks in the same machine which is your local machine, utilize the number of cores in that machine to perform parallelism</li><li><strong>Running in a cluster:</strong> Spark distribute the tasks to all the machine in the cluster. There are 2 deploy modes which are client mode and cluster mode, with 4 options of cluster resource manager, which are Spark standalone cluster manager, Apache Mesos, Hadoop Yarn, or Kubernetes.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-create-a-base-image-for-the-cluster">2. Create a base image for the cluster<a class="hash-link" href="#2-create-a-base-image-for-the-cluster" title="Direct link to heading">​</a></h3><p>Because the images of the nodes in a cluster need to install the same software, we will build a base image for the whole cluster first, then the following images will import from this image and add the following images. other necessary dependencies.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">debian_buster_image_tag</span><span class="token operator">=</span><span class="token number">8</span><span class="token plain">-jre-slim</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM openjdk:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${debian_buster_image_tag}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">shared_workspace</span><span class="token operator">=</span><span class="token plain">/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> -p </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${shared_workspace}</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> update -y </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y python3 </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">ln</span><span class="token plain"> -s /usr/bin/python3 /usr/bin/python </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">SHARED_WORKSPACE</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${shared_workspace}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">VOLUME </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${shared_workspace}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here, since Spark requires java version 8 or 11, we will create an image running jdk 8, we will take the variable <code>shared_workspace</code> as the Jupyterlab working environment path (later). In addition, we will install <code>python3</code> for running Jupyterlab.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-create-a-spark-base-image">3. Create a spark base image<a class="hash-link" href="#3-create-a-spark-base-image" title="Direct link to heading">​</a></h3><p>We come to create a spark base image with common packages for master node and worker node.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM spark-cluster-base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">spark_version</span><span class="token operator">=</span><span class="token number">3.2</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">hadoop_version</span><span class="token operator">=</span><span class="token number">3.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> update -y </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> https://archive.apache.org/dist/spark/spark-</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${spark_version}</span><span class="token plain">/spark-</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${spark_version}</span><span class="token plain">-bin-hadoop</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${hadoop_version}</span><span class="token plain">.tgz -o spark.tgz </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> -xf spark.tgz </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> spark-</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${spark_version}</span><span class="token plain">-bin-hadoop</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${hadoop_version}</span><span class="token plain"> /usr/bin/ </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> /usr/bin/spark-</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${spark_version}</span><span class="token plain">-bin-hadoop</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${hadoop_version}</span><span class="token plain">/logs </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> spark.tgz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV SPARK_HOME /usr/bin/spark-</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${spark_version}</span><span class="token plain">-bin-hadoop</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${hadoop_version}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV SPARK_MASTER_HOST spark-master</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV SPARK_MASTER_PORT </span><span class="token number">7077</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENV PYSPARK_PYTHON python3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WORKDIR </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${SPARK_HOME}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>First, we will import the image from the base image above (that is <code>spark-cluster-base</code>, this name will be assigned at build time), listing the compatible Spark and Hadoop versions. You can check version compatibility on Spark&#x27;s homepage.</p><p><img loading="lazy" alt="Spark Version" src="/assets/images/spark-version-dc51155270739185cc493d4ae6ccb2a7.PNG" width="1625" height="560" class="img_ev3q"></p><p>Then it will be to download and extract Spark, along with creating the necessary environment variables to support running the command line later. Here, <code>SPARK_MASTER_HOST</code> and <code>SPARK_MASTER_PORT</code> used by worker nodes to register with the corresponding master node address.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-create-a-master-node-image">4. Create a master node image<a class="hash-link" href="#4-create-a-master-node-image" title="Direct link to heading">​</a></h3><p>Having a spark base image, we start creating the master node by importing that base image and adding the appropriate variables to the master node as the port of the web ui interface so we can interact with spark on the interface later.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM spark-base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">spark_master_web_ui</span><span class="token operator">=</span><span class="token number">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXPOSE </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${spark_master_web_ui}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${SPARK_MASTER_PORT}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CMD bin/spark-class org.apache.spark.deploy.master.Master </span><span class="token operator">&gt;&gt;</span><span class="token plain"> logs/spark-master.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above command is to run master node.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-create-a-worker-node-image">5. Create a worker node image<a class="hash-link" href="#5-create-a-worker-node-image" title="Direct link to heading">​</a></h3><p>Next is to create worker node</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM spark-base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">spark_worker_web_ui</span><span class="token operator">=</span><span class="token number">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXPOSE </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${spark_worker_web_ui}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CMD bin/spark-class org.apache.spark.deploy.worker.Worker spark://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${SPARK_MASTER_HOST}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${SPARK_MASTER_PORT}</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> logs/spark-worker.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above command is to run the worker node and point to the address of the master node to register.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-create-a-jupyterlab-image-for-testing">6. Create a Jupyterlab image for testing<a class="hash-link" href="#6-create-a-jupyterlab-image-for-testing" title="Direct link to heading">​</a></h3><p>Finally, to test the spark cluster working, we will install Jupyterlab and use pyspark to run the code.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM spark-cluster-base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">spark_version</span><span class="token operator">=</span><span class="token number">3.2</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ARG </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">jupyterlab_version</span><span class="token operator">=</span><span class="token number">3.2</span><span class="token plain">.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> update -y </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y python3-pip </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pip3 </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">pyspark</span><span class="token operator">==</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${spark_version}</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">jupyterlab</span><span class="token operator">==</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${jupyterlab_version}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXPOSE </span><span class="token number">8888</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WORKDIR </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${SHARED_WORKSPACE}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CMD jupyter lab --ip</span><span class="token operator">=</span><span class="token number">0.0</span><span class="token plain">.0.0 --port</span><span class="token operator">=</span><span class="token number">8888</span><span class="token plain"> --no-browser --allow-root --NotebookApp.token</span><span class="token operator">=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Along with that is to list the command to run Jupyter on port 8888.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-combine-images-and-create-containers">7. Combine images and create containers<a class="hash-link" href="#7-combine-images-and-create-containers" title="Direct link to heading">​</a></h3><p>After creating all the Dockerfiles, we proceed to build the appropriate images.</p><p><img loading="lazy" alt="Folder Structure" src="/assets/images/folder-structure-96413f7b1388654821531bfb39bbd777.PNG" width="1300" height="890" class="img_ev3q"></p><p><strong>Listing versions</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">SPARK_VERSION</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3.2.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">HADOOP_VERSION</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3.2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">JUPYTERLAB_VERSION</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3.2.5&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build base image</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> build </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --platform</span><span class="token operator">=</span><span class="token plain">linux/arm64 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f cluster_base/Dockerfile </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-cluster-base </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build spark base image</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> build </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --build-arg </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">spark_version</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${SPARK_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --build-arg </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">hadoop_version</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${HADOOP_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f spark_base/Dockerfile </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-base </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build master node image</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> build </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f master_node/Dockerfile </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-master </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build worker node image</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> build </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f worker_node/Dockerfile </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-worker </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Build Jupyterlab image</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> build </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --build-arg </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">spark_version</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${SPARK_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --build-arg </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">jupyterlab_version</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${JUPYTERLAB_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -f jupyter_lab/Dockerfile </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -t spark-jupyterlab </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, to create the necessary containers, we create a file <code>docker-compose.yml</code> with the following content</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">version: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3.6&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  shared-workspace:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;hadoop-distributed-file-system&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    driver: </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  jupyterlab:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: spark-jupyterlab</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    container_name: jupyterlab</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token number">8888</span><span class="token plain">:8888</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - shared-workspace:/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  spark-master:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: spark-master</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    container_name: spark-master</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token number">8080</span><span class="token plain">:8080</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token number">7077</span><span class="token plain">:7077</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - shared-workspace:/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  spark-worker-1:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: spark-worker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    container_name: spark-worker-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">SPARK_WORKER_CORES</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">SPARK_WORKER_MEMORY</span><span class="token operator">=</span><span class="token plain">512m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token number">8081</span><span class="token plain">:8081</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - shared-workspace:/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    depends_on:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - spark-master</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  spark-worker-2:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: spark-worker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    container_name: spark-worker-2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">SPARK_WORKER_CORES</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">SPARK_WORKER_MEMORY</span><span class="token operator">=</span><span class="token plain">512m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - </span><span class="token number">8082</span><span class="token plain">:8081</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - shared-workspace:/opt/workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    depends_on:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - spark-master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Include the volume in which we will save data so that when deleting containers, data will not be lost, along with the necessary containers (services). To each container the appropriate environment variables are added, the ports to map to the host machine, and the order in which the containers are run. Here, the master node has to run first to get the hostname, so the worker node will depend on the master node container. After that, we run <code>docker-compose up</code>, so we have launched all the necessary containers.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-running-jupyterlab-to-check-the-cluster">8. Running Jupyterlab to check the cluster<a class="hash-link" href="#8-running-jupyterlab-to-check-the-cluster" title="Direct link to heading">​</a></h3><p>After running <code>docker-compose up</code> and seeing in the terminal the logs showing that the master node and worker node have been successfully started, along with the successful register status of the nodes, we go to <code>localhost:8080</code> to access spark ui.</p><p><img loading="lazy" alt="Spark UI" src="/assets/images/spark-ui-93f0b9c11bae35ea288c92bb45c0dcb1.PNG" width="2304" height="1059" class="img_ev3q"></p><p>In the interface, we can see that there are 2 workers working as red circled areas.</p><p>Enter <code>localhost:8888</code> to access the Jupyterlab interface, execute the following code</p><p><img loading="lazy" alt="Jupyter Lab" src="/assets/images/jupyterlab-843081ca92d06c16577ee369fcea9f86.PNG" width="2304" height="1307" class="img_ev3q"></p><p>Run the code, then go back to spark ui, we can see our application is running</p><p><img loading="lazy" alt="Application" src="/assets/images/application-6257f914f09a8cad5d6c19bd2f2a5a9e.PNG" width="2304" height="988" class="img_ev3q"></p><p>Click on the application, we see our workers processing the job</p><p><img loading="lazy" alt="Application Workers" src="/assets/images/application-workers-299c2630b4d6df5db037a2ec8f133173.PNG" width="2302" height="761" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_u0Nl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/bigdata">Bigdata</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/spark">Spark</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/apache">Apache</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/docker">Docker</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/lam1051999/blogs/edit/main/blog/2022-01-01-spark-cluster-docker/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><div class="margin-vert--xl"></div><div class="margin-vert--lg" style="display:flex;align-items:center;justify-content:center"><a class="button button--link" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flam-tran.dev%2F%2Fblog%2Fspark-cluster-docker&amp;text=I%20just%20read%20%22Create%20A%20Standalone%20Spark%20Cluster%20With%20Docker%22%20by%20%40lamtt1005" target="_blank" rel="noreferrer noopener" style="display:inline-flex;align-items:center"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 248 204" height="20" width="20" style="margin-right:7px"><g><path fill="#1D9BF0" d="M221.95,51.29c0.15,2.17,0.15,4.34,0.15,6.53c0,66.73-50.8,143.69-143.69,143.69v-0.04 C50.97,201.51,24.1,193.65,1,178.83c3.99,0.48,8,0.72,12.02,0.73c22.74,0.02,44.83-7.61,62.72-21.66 c-21.61-0.41-40.56-14.5-47.18-35.07c7.57,1.46,15.37,1.16,22.8-0.87C27.8,117.2,10.85,96.5,10.85,72.46c0-0.22,0-0.43,0-0.64 c7.02,3.91,14.88,6.08,22.92,6.32C11.58,63.31,4.74,33.79,18.14,10.71c25.64,31.55,63.47,50.73,104.08,52.76 c-4.07-17.54,1.49-35.92,14.61-48.25c20.34-19.12,52.33-18.14,71.45,2.19c11.31-2.23,22.15-6.38,32.07-12.26 c-3.77,11.69-11.66,21.62-22.2,27.93c10.01-1.18,19.79-3.86,29-7.95C240.37,35.29,231.83,44.14,221.95,51.29z"></path></g></svg>Share on Twitter</a></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/spark-kafka-docker"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Create A Data Streaming Pipeline With Spark Streaming, Kafka And Docker</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/avl-tree"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">AVL Tree, AVL Sorting Algorithm</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-overview-of-a-spark-cluster" class="table-of-contents__link toc-highlight">1. Overview of a Spark cluster</a></li><li><a href="#2-create-a-base-image-for-the-cluster" class="table-of-contents__link toc-highlight">2. Create a base image for the cluster</a></li><li><a href="#3-create-a-spark-base-image" class="table-of-contents__link toc-highlight">3. Create a spark base image</a></li><li><a href="#4-create-a-master-node-image" class="table-of-contents__link toc-highlight">4. Create a master node image</a></li><li><a href="#5-create-a-worker-node-image" class="table-of-contents__link toc-highlight">5. Create a worker node image</a></li><li><a href="#6-create-a-jupyterlab-image-for-testing" class="table-of-contents__link toc-highlight">6. Create a Jupyterlab image for testing</a></li><li><a href="#7-combine-images-and-create-containers" class="table-of-contents__link toc-highlight">7. Combine images and create containers</a></li><li><a href="#8-running-jupyterlab-to-check-the-cluster" class="table-of-contents__link toc-highlight">8. Running Jupyterlab to check the cluster</a></li></ul></div></div></div></div></div><div class="footer-wrapper footer--dark"><div class="container margin-vert--lg"><div style="display:flex;justify-content:center"><div style="max-width:650px">I am a highly motivated and passionate data engineer. I often work with Python, Scala, and Java and use the latest big data technologies to solve problems, making tools to improve my and others&#x27; work productivity.<a target="_blank" rel="noreferrer noopener" href="https://www.buymeacoffee.com/lamtran" style="display:block;margin-top:10px"><img loading="lazy" style="height:50px;width:50px" src="/img/donate.jpg"></a></div><div style="margin-left:30px;min-width:162px"><img loading="lazy" src="/img/avatar.jpg" style="height:130px;width:136px"><p style="font-size:0.8em;margin-top:1em">Lam Tran<br>Data Engineer</p></div></div></div><div style="display:flex;justify-content:center"><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">About</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:lam1051999@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mail<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/lamtt1005" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="tel:+84962007024" target="_blank" rel="noopener noreferrer" class="footer__link-item">Phone<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/lam1051999" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Lam Tran. Powered by <a target="_blank" rel="noreferrer noopener" style="color:white;font-weight:bold;" href="https://docusaurus.io/">Docusaurus 2</a></div></div></div></footer></div></div></div>
<script src="/assets/js/runtime~main.2ccc56fd.js"></script>
<script src="/assets/js/main.22b74e23.js"></script>
</body>
</html>