"use strict";(self.webpackChunkkgajera_blog=self.webpackChunkkgajera_blog||[]).push([[705],{3905:(t,e,n)=>{n.d(e,{Zo:()=>p,kt:()=>m});var a=n(7294);function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e){if(null==t)return{};var n,a,i=function(t,e){if(null==t)return{};var n,a,i={},r=Object.keys(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var l=a.createContext({}),s=function(t){var e=a.useContext(l),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},p=function(t){var e=s(t.components);return a.createElement(l.Provider,{value:e},t.children)},g={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},h=a.forwardRef((function(t,e){var n=t.components,i=t.mdxType,r=t.originalType,l=t.parentName,p=c(t,["components","mdxType","originalType","parentName"]),h=s(n),m=i,d=h["".concat(l,".").concat(m)]||h[m]||g[m]||r;return n?a.createElement(d,o(o({ref:e},p),{},{components:n})):a.createElement(d,o({ref:e},p))}));function m(t,e){var n=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var r=n.length,o=new Array(r);o[0]=h;var c={};for(var l in e)hasOwnProperty.call(e,l)&&(c[l]=e[l]);c.originalType=t,c.mdxType="string"==typeof t?t:i,o[1]=c;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},9779:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>c,toc:()=>s});var a=n(7462),i=(n(7294),n(3905));const r={slug:"spark-catalyst-optimizer-and-spark-extension",title:"Spark catalyst optimizer v\xe0 Spark extension",authors:"tranlam",tags:["Bigdata","Spark","Apache"],image:"./images/spark-catalyst-optimizer.JPG"},o=void 0,c={permalink:"/blogs/blog/spark-catalyst-optimizer-and-spark-extension",editUrl:"https://github.com/lam1051999/blogs/edit/main/blog/2023-01-01-spark-catalyst-optimizer-and-spark-extension/index.md",source:"@site/blog/2023-01-01-spark-catalyst-optimizer-and-spark-extension/index.md",title:"Spark catalyst optimizer v\xe0 Spark extension",description:"Spark catalyst optimizer n\u1eb1m trong ph\u1ea7n core c\u1ee7a Spark SQL v\u1edbi m\u1ee5c \u0111\xedch t\u1ed1i \u01b0u c\xe1c truy v\u1ea5n c\xf3 c\u1ea5u tr\xfac \u0111\u01b0\u1ee3c th\u1ec3 hi\u1ec7n d\u01b0\u1edbi d\u1ea1ng SQL ho\u1eb7c qua c\xe1c API DataFrame/Dataset, gi\u1ea3m thi\u1ec3u th\u1eddi gian v\xe0 chi ph\xed ch\u1ea1y c\u1ee7a \u1ee9ng d\u1ee5ng. Khi s\u1eed d\u1ee5ng Spark, th\u01b0\u1eddng m\u1ecdi ng\u01b0\u1eddi xem catalyst optimizer nh\u01b0 l\xe0 m\u1ed9t black box, khi ch\xfang ta m\u1eb7c nhi\xean cho r\u1eb1ng n\xf3 ho\u1ea1t \u0111\u1ed9ng m\u1ed9t c\xe1ch th\u1ea7n b\xed m\xe0 kh\xf4ng th\u1ef1c s\u1ef1 quan t\xe2m b\xean trong n\xf3 x\u1ea3y ra nh\u1eefng g\xec. \u1ede b\xe0i vi\u1ebft n\xe0y, m\xecnh s\u1ebd \u0111i v\xe0o t\xecm hi\u1ec3u b\xean trong logic c\u1ee7a n\xf3 th\u1ef1c s\u1ef1 th\u1ebf n\xe0o, c\xe1c th\xe0nh ph\u1ea7n, v\xe0 c\xe1ch m\xe0 Spark extension tham gia \u0111\u1ec3 thay \u0111\u1ed5i c\xe1c plan c\u1ee7a catalyst.",date:"2023-01-01T00:00:00.000Z",formattedDate:"January 1, 2023",tags:[{label:"Bigdata",permalink:"/blogs/blog/tags/bigdata"},{label:"Spark",permalink:"/blogs/blog/tags/spark"},{label:"Apache",permalink:"/blogs/blog/tags/apache"}],readingTime:1.905,truncated:!0,authors:[{name:"Tr\u1ea7n L\xe2m",title:"Data Engineer",url:"https://github.com/lam1051999",imageURL:"https://github.com/lam1051999.png",key:"tranlam"}],frontMatter:{slug:"spark-catalyst-optimizer-and-spark-extension",title:"Spark catalyst optimizer v\xe0 Spark extension",authors:"tranlam",tags:["Bigdata","Spark","Apache"],image:"./images/spark-catalyst-optimizer.JPG"},nextItem:{title:"MySQL series - Indexing",permalink:"/blogs/blog/mysql-series-mysql-indexing"}},l={image:n(642).Z,authorsImageUrls:[void 0]},s=[{value:"1. Tree v\xe0 Node",id:"1-tree-v\xe0-node",level:3},{value:"2. C\xe1c ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Catalyst trong Spark SQL",id:"2-c\xe1c-ho\u1ea1t-\u0111\u1ed9ng-c\u1ee7a-catalyst-trong-spark-sql",level:3},{value:"2.1. Parsing v\xe0 Analyzing",id:"21-parsing-v\xe0-analyzing",level:4},{value:"2.2. Logical optimizations",id:"22-logical-optimizations",level:4},{value:"2.3. Physical planning",id:"23-physical-planning",level:4},{value:"2.3.1. Quantitative optimizations",id:"231-quantitative-optimizations",level:5},{value:"2.3.2. The Cost-Based Optimizer",id:"232-the-cost-based-optimizer",level:5},{value:"2.4. Code generation",id:"24-code-generation",level:4},{value:"2.5. T\xednh n\u0103ng Adaptive query execution trong Spark 3",id:"25-t\xednh-n\u0103ng-adaptive-query-execution-trong-spark-3",level:4},{value:"3. Spark extension",id:"3-spark-extension",level:3}],p={toc:s};function g(t){let{components:e,...r}=t;return(0,i.kt)("wrapper",(0,a.Z)({},p,r,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Spark catalyst optimizer n\u1eb1m trong ph\u1ea7n core c\u1ee7a Spark SQL v\u1edbi m\u1ee5c \u0111\xedch t\u1ed1i \u01b0u c\xe1c truy v\u1ea5n c\xf3 c\u1ea5u tr\xfac \u0111\u01b0\u1ee3c th\u1ec3 hi\u1ec7n d\u01b0\u1edbi d\u1ea1ng SQL ho\u1eb7c qua c\xe1c API DataFrame/Dataset, gi\u1ea3m thi\u1ec3u th\u1eddi gian v\xe0 chi ph\xed ch\u1ea1y c\u1ee7a \u1ee9ng d\u1ee5ng. Khi s\u1eed d\u1ee5ng Spark, th\u01b0\u1eddng m\u1ecdi ng\u01b0\u1eddi xem catalyst optimizer nh\u01b0 l\xe0 m\u1ed9t black box, khi ch\xfang ta m\u1eb7c nhi\xean cho r\u1eb1ng n\xf3 ho\u1ea1t \u0111\u1ed9ng m\u1ed9t c\xe1ch th\u1ea7n b\xed m\xe0 kh\xf4ng th\u1ef1c s\u1ef1 quan t\xe2m b\xean trong n\xf3 x\u1ea3y ra nh\u1eefng g\xec. \u1ede b\xe0i vi\u1ebft n\xe0y, m\xecnh s\u1ebd \u0111i v\xe0o t\xecm hi\u1ec3u b\xean trong logic c\u1ee7a n\xf3 th\u1ef1c s\u1ef1 th\u1ebf n\xe0o, c\xe1c th\xe0nh ph\u1ea7n, v\xe0 c\xe1ch m\xe0 Spark extension tham gia \u0111\u1ec3 thay \u0111\u1ed5i c\xe1c plan c\u1ee7a catalyst."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"spark catalyst optimizer",src:n(642).Z,width:"1280",height:"720"})),(0,i.kt)("h3",{id:"1-tree-v\xe0-node"},"1. Tree v\xe0 Node"),(0,i.kt)("p",null,"C\xe1c th\xe0nh ph\u1ea7n ch\xednh trong Catalyst \u0111\u01b0\u1ee3c bi\u1ec3u di\u1ec5n d\u01b0\u1edbi d\u1ea1ng c\xe2y v\xe0 c\xe1c node, \u0111\u01b0\u1ee3c k\u1ebf th\u1eeba t\u1eeb class ",(0,i.kt)("inlineCode",{parentName:"p"},"TreeNode"),", ho\u1eb7c c\xe1c class con c\u1ee7a n\xf3. Class ",(0,i.kt)("inlineCode",{parentName:"p"},"TreeNode")," n\xe0y c\xf3 t\u1eadp c\xe1c node con \u1ee9ng v\u1edbi thu\u1ed9c t\xednh ",(0,i.kt)("inlineCode",{parentName:"p"},"children"),", ki\u1ec3u d\u1eef li\u1ec7u ",(0,i.kt)("inlineCode",{parentName:"p"},"Seq[BaseType]"),", do v\u1eady, m\u1ed9t ",(0,i.kt)("inlineCode",{parentName:"p"},"TreeNode")," c\xf3 th\u1ec3 c\xf3 0 ho\u1eb7c nhi\u1ec1u c\xe1c node con. C\xe1c object n\xe0y l\xe0 immutable v\xe0 \u0111\u01b0\u1ee3c thao t\xe1c b\u1eb1ng nh\u1eefng functional transformation, khi\u1ebfn cho vi\u1ec7c debug optimizer tr\u1edf n\xean d\u1ec5 d\xe0ng h\u01a1n v\xe0 c\xe1c ho\u1ea1t \u0111\u1ed9ng song song tr\u1edf n\xean d\u1ec5 \u0111o\xe1n h\u01a1n.",(0,i.kt)("br",{parentName:"p"}),"\n","Hai class quan tr\u1ecdng l\xe0 ",(0,i.kt)("inlineCode",{parentName:"p"},"LogicalPlan")," v\xe0 ",(0,i.kt)("inlineCode",{parentName:"p"},"SparkPlan")," \u0111\u1ec1u l\xe0 subclass c\u1ee7a ",(0,i.kt)("inlineCode",{parentName:"p"},"QueryPlan"),", class k\u1ebf th\u1eeba tr\u1ef1c ti\u1ebfp t\u1eeb ",(0,i.kt)("inlineCode",{parentName:"p"},"TreeNode"),". Trong s\u01a1 \u0111\u1ed3 Catalyst b\xean tr\xean, 3 th\xe0nh ph\u1ea7n \u0111\u1ea7u l\xe0 c\xe1c logical plans, c\xe1c node trong logical plan th\u01b0\u1eddng l\xe0 c\xe1c to\xe1n t\u1eed \u0111\u1ea1i s\u1ed1 nh\u01b0 join, and, or,... 2 th\xe0nh ph\u1ea7n \u0111\u1eb1ng sau l\xe0 c\xe1c spark plan (physical plan), c\xe1c node th\u01b0\u1eddng l\xe0 c\xe1c to\xe1n t\u1eed low-level nh\u01b0 ",(0,i.kt)("inlineCode",{parentName:"p"},"ShuffledHashJoinExec"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"SortMergeJoinExec"),",... C\xe1c leaf node s\u1ebd \u0111\u1ecdc d\u1eef li\u1ec7u t\u1eeb c\xe1c source, storage, memory,... c\xf2n root node c\u1ee7a c\xe2y l\xe0 to\xe1n t\u1eed ngo\xe0i c\xf9ng v\xe0 tr\u1ea3 v\u1ec1 k\u1ebft qu\u1ea3 c\u1ee7a vi\u1ec7c t\xednh to\xe1n."),(0,i.kt)("h3",{id:"2-c\xe1c-ho\u1ea1t-\u0111\u1ed9ng-c\u1ee7a-catalyst-trong-spark-sql"},"2. C\xe1c ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Catalyst trong Spark SQL"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"spark catalyst pipeline",src:n(1017).Z,width:"642",height:"519"})),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Coming soon"))),(0,i.kt)("h4",{id:"21-parsing-v\xe0-analyzing"},"2.1. Parsing v\xe0 Analyzing"),(0,i.kt)("h4",{id:"22-logical-optimizations"},"2.2. Logical optimizations"),(0,i.kt)("h4",{id:"23-physical-planning"},"2.3. Physical planning"),(0,i.kt)("h5",{id:"231-quantitative-optimizations"},"2.3.1. Quantitative optimizations"),(0,i.kt)("h5",{id:"232-the-cost-based-optimizer"},"2.3.2. The Cost-Based Optimizer"),(0,i.kt)("h4",{id:"24-code-generation"},"2.4. Code generation"),(0,i.kt)("h4",{id:"25-t\xednh-n\u0103ng-adaptive-query-execution-trong-spark-3"},"2.5. T\xednh n\u0103ng Adaptive query execution trong Spark 3"),(0,i.kt)("h3",{id:"3-spark-extension"},"3. Spark extension"))}g.isMDXComponent=!0},1017:(t,e,n)=>{n.d(e,{Z:()=>a});const a=n.p+"assets/images/catalyst-pipeline-3a34b5a78a6bc0c104ba73c12ee7071e.webp"},642:(t,e,n)=>{n.d(e,{Z:()=>a});const a=n.p+"assets/images/spark-catalyst-optimizer-03f0f2a4cb6e0c86499aaa51ba69b065.JPG"}}]);