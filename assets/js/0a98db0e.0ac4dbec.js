"use strict";(self.webpackChunklamtran_blog=self.webpackChunklamtran_blog||[]).push([[7208],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>p});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=c(n),g=r,p=m["".concat(l,".").concat(g)]||m[g]||u[g]||o;return n?a.createElement(p,i(i({ref:t},d),{},{components:n})):a.createElement(p,i({ref:t},d))}));function p(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},2649:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={slug:"mysql-series-mysql-mvcc/",title:"MySQL series - Multiversion concurrency control",description:"MySQL series - Multiversion concurrency control",authors:"tranlam",tags:["Bigdata","MySQL","Database","Data Engineering","Transaction"],image:"./images/overall.PNG"},i=void 0,s={permalink:"/blog/mysql-series-mysql-mvcc/",editUrl:"https://github.com/LTranData/blogs/edit/main/blog/2022-10-07-mysql-multiversion-concurrency-control/index.md",source:"@site/blog/2022-10-07-mysql-multiversion-concurrency-control/index.md",title:"MySQL series - Multiversion concurrency control",description:"MySQL series - Multiversion concurrency control",date:"2022-10-07T00:00:00.000Z",formattedDate:"October 7, 2022",tags:[{label:"Bigdata",permalink:"/blog/tags/bigdata"},{label:"MySQL",permalink:"/blog/tags/my-sql"},{label:"Database",permalink:"/blog/tags/database"},{label:"Data Engineering",permalink:"/blog/tags/data-engineering"},{label:"Transaction",permalink:"/blog/tags/transaction"}],readingTime:2.025,truncated:!0,authors:[{name:"Lam Tran",title:"Data Engineer",url:"https://github.com/LTranData",imageURL:"https://github.com/LTranData.png",key:"tranlam"}],frontMatter:{slug:"mysql-series-mysql-mvcc/",title:"MySQL series - Multiversion concurrency control",description:"MySQL series - Multiversion concurrency control",authors:"tranlam",tags:["Bigdata","MySQL","Database","Data Engineering","Transaction"],image:"./images/overall.PNG"},prevItem:{title:"MySQL series - Indexing",permalink:"/blog/mysql-series-mysql-indexing/"},nextItem:{title:"MySQL series - Transaction In MySQL",permalink:"/blog/mysql-series-mysql-transaction/"}},l={image:n(3077).Z,authorsImageUrls:[void 0]},c=[{value:"Introduction to MVCC",id:"introduction-to-mvcc",level:2},{value:"MVCC in InnoDB",id:"mvcc-in-innodb",level:2},{value:"Isolation level with MVCC",id:"isolation-level-with-mvcc",level:2}],d={toc:c};function m(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Usually storage engines do not use a simple row lock mechanism, to achieve good performance in a highly concurrent read and write environment, storage engines implement row locking with a certain complexity, the method is often used, is multiversion concurrency control (MVCC)."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"MVCC Overall",src:n(3077).Z,width:"896",height:"520"})),(0,r.kt)("h2",{id:"introduction-to-mvcc"},"Introduction to MVCC"),(0,r.kt)("p",null,"MVCC is used in many types of relational databases, it helps us to lock as little data as possible when doing many transactions at once, it can allow us to not be locked when reading data and only lock the necessary rows when writing data."),(0,r.kt)("h2",{id:"mvcc-in-innodb"},"MVCC in InnoDB"),(0,r.kt)("p",null,"MVCC works by taking snapshots of data at some point in time, so a transaction can see the same data no matter how fast or long it takes. However, it also causes different transactions to see different data views of the same table at the same time."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"MVCC Detail Example",src:n(3059).Z,width:"1044",height:"528"})),(0,r.kt)("p",null,"InnoDB will assign a transaction id to a transaction every time it starts reading some data. The changes of a record in that transaction will be written to the undo log for data revert, and the rollback pointer of that transaction will point to the location of that undo log. When another session starts reading the mutated record above, InnoDB compares the transaction id of the record with the data view that new session read. If the record is in a state that is invisible to other transactions (e.g. a transaction that changes that record has not been committed), the undo log will be applied on the data view until the record becomes available again, readable by other transactions."),(0,r.kt)("p",null,"All undo logs recorded are copied to the redo log because they are used for data recovery in the event of a system failure. The size of the undo log and redo log also affects the ability to perform read and write in environments with high concurrent read and write."),(0,r.kt)("p",null,"While the benefit is that we are never locked when reading, the storage engine needs to store more data with each record, do more control work, and perform more operations."),(0,r.kt)("h2",{id:"isolation-level-with-mvcc"},"Isolation level with MVCC"),(0,r.kt)("p",null,"MVCC is only available with REPEATABLE READ and READ COMMITTED modes. MVCC is not compatible with READ UNCOMMITTED because queries will not read records whose version does not match the transaction's version. MVCC is not compatible with SERIALIZABLE because of its read locking (you can find ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/blog/mysql-series-mysql-transaction/#3-four-isolation-level-in-highly-concurrent-read-and-write-environments"},"four isolation levels"))," in my previous blog)."))}m.isMDXComponent=!0},3059:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/detail-d445b09c01125fc9fb4a17f23684d87d.PNG"},3077:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/overall-5aef626a539a997cb798b7c8ba37afc6.PNG"}}]);